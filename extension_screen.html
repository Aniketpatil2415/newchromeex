<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>FusionByte - Daily Challenge</title>
    <link rel="stylesheet" href="extension_style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <style>
        /* Basic CSS for the question display */
        .question-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .question-container h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .options-list {
            list-style-type: none;
            padding: 0;
        }

        .options-list li {
            margin-bottom: 8px;
        }

        .options-list button {
            padding: 8px 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            background-color: #f9f9f9;
            transition: background-color 0.3s ease;
        }

        .options-list button:hover {
            background-color: #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”¥ Daily Coding Challenge</h1>
            <p>Stay consistent. Build your streak!</p>
        </header>

        <main>
            <section class="question-box">
                <div id="question-display" class="question-container">
                    <h2>Loading Today's Challenge...</h2>
                </div>
                <textarea id="answer" placeholder="Write your answer here..."></textarea>
                <button id="submit-btn">ðŸš€ Submit Answer</button>
            </section>

            <section class="streak-box">
                <p>ðŸ”¥ Your Current Streak:</p>
                <h3><span id="streak">0</span> Days</h3>
            </section>
        </main>
    </div>

    <div class="bottom-nav">
        <ul>
            <li><a href="#"><i class="fas fa-home"></i><span>Home</span></a></li>

            <li><a href="#" class="active"><i class="fas fa-trophy"></i><span>Leaderboard</span></a></li>

            <li><a href="#"><i class="fas fa-chalkboard-teacher"></i><span>Challenge</span></a></li>
            <li><a href="#"><i class="fas fa-user-circle"></i><span>Profile</span></a></li>
        </ul>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDGNl1qDTgmeloZRaMlNIqADYF99JAsveg",
          authDomain: "notes-app-42c4f.firebaseapp.com",
          projectId: "notes-app-42c4f",
          storageBucket: "notes-app-42c4f.appspot.com",
          messagingSenderId: "423058349540",
          appId: "1:423058349540:web:942108589731326aa03bf1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Get elements
        const submitButton = document.getElementById("submit-btn");
        const answerTextArea = document.getElementById("answer");
        const streakElement = document.getElementById("streak");
        const questionDisplay = document.getElementById("question-display");

        // Get the current date (used to track daily streak)
        const currentDate = new Date().toLocaleDateString();

        // Function to fetch the daily question from Firestore
        const fetchDailyQuestion = async () => {
            try {
                const docRef = db.collection('questions').doc('question1');
                const docSnap = await docRef.get();

                if (docSnap.exists()) {
                    const questionData = docSnap.data();
                    displayQuestion(questionData);
                } else {
                    questionDisplay.innerHTML = "<p class='error-message'>Failed to load today's challenge.</p>";
                    console.log("No such document!");
                }
            } catch (error) {
                questionDisplay.innerHTML = "<p class='error-message'>Error loading challenge: " + error.message + "</p>";
                console.error("Error fetching document:", error);
            }
        };

        // Function to display the question and options
        const displayQuestion = (questionData) => {
            questionDisplay.innerHTML = `
                <h2>${questionData.questionText}</h2>
                <ul class="options-list">
                    ${questionData.options.map((option, index) => `<li><button data-option-index="${index}">${option}</button></li>`).join('')}
                </ul>
                <p class="correct-answer-hidden" style="display:none;">Correct Answer: ${questionData.correctAnswer}</p>
            `;

            // Add event listeners to the option buttons (optional, for handling user selection)
            const optionButtons = questionDisplay.querySelectorAll('.options-list button');
            optionButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const selectedAnswer = event.target.textContent;
                    const correctAnswer = questionDisplay.querySelector('.correct-answer-hidden').textContent.split(': ')[1];
                    if (selectedAnswer === correctAnswer) {
                        alert("Correct!");
                        updateStreak(); // Increase streak on correct answer
                    } else {
                        alert(`Incorrect. The correct answer is: ${correctAnswer}`);
                        // Optionally reset streak here if the logic requires
                    }
                    // You might want to disable further selections or provide feedback
                });
            });
        };

        // Function to handle streak increase
        const updateStreak = () => {
            const lastStreakDate = localStorage.getItem("lastStreakDate");
            const currentStreak = parseInt(localStorage.getItem("currentStreak")) || 0;

            // Check if last streak was today
            if (lastStreakDate === currentDate) {
                console.log("Streak already increased today.");
                return; // If already streaked today, do nothing
            } else {
                // Update streak count
                const newStreak = currentStreak + 1;
                localStorage.setItem("currentStreak", newStreak);
                localStorage.setItem("lastStreakDate", currentDate);
                streakElement.textContent = `${newStreak}`;
                console.log("Streak increased!");
            }
        };

        // Function to handle submit action (you might want to adjust this based on the question type)
        submitButton.addEventListener("click", () => {
            if (answerTextArea.value.trim() !== "") {
                // For open-ended questions, you might just track submission for streak
                updateStreak();
                answerTextArea.value = "";
                alert("Answer submitted! Streak updated.");
            } else {
                alert("Please write an answer before submitting.");
            }
        });

        // Set initial streak value and fetch the question when page loads
        window.onload = () => {
            const storedStreak = localStorage.getItem("currentStreak");
            if (storedStreak) {
                streakElement.textContent = storedStreak;
            } else {
                streakElement.textContent = "0"; // Default streak if none exists
            }
            fetchDailyQuestion();
        };
    </script>
</body>
</html>
